name: Run performance tests

on:
  pull_request:
    branches: [ main ]
    types: [ opened, synchronize, reopened, ready_for_review ]
    paths-ignore:
      - "**.md"
      - "sec-scanners-config.yaml"

jobs:
  run-performance-tests:
    uses: "./.github/workflows/run-performance-tests-reusable.yaml"
    with:
      # Release Configuration
      release: "false"
      version: ${{ github.event.pull_request.number }}
      
      # Test Configuration
      instances-number: "100"
      updates-number: "300"
      
      # Timing Configuration
      kim-delay-seconds: "0"
      provisioning-max-step-processing-time: "30s"
      update-max-step-processing-time: "30s"
      deprovisioning-max-step-processing-time: "30s"
      baseline-monitoring-minutes: "0"
      post-test-monitoring-minutes: "0"
      
      # Workers Configuration
      provisioning-workers-amount: "25"
      update-workers-amount: "25"
      deprovisioning-workers-amount: "25"
      
      # Leak Detection Thresholds (use defaults)
      memory-growth-threshold-percent: "70"
      goroutine-increase-threshold: "50"
      fd-increase-threshold: "10"
      db-conn-increase-threshold: "5"